# 🛒 Grocery Scraper API

A powerful AI-powered grocery product discovery API that combines **Perplexity Sonar** for intelligent product search with **Serper.dev** for real product URLs and images.

## ✨ Features

### 🤖 AI-Powered Product Discovery
- **Perplexity Sonar Integration**: Uses advanced AI to find products across multiple stores
- **Smart Product Matching**: Intelligent matching of product names and descriptions
- **Real-time Store Discovery**: Find grocery stores in any location with detailed information

### 🔗 Real Product Data
- **Real Product URLs**: Direct links to Google Shopping product pages
- **High-Quality Images**: Product images from Google's CDN
- **Live Pricing**: Current prices from various retailers
- **Customer Ratings**: Real ratings and review counts
- **Store-Specific Results**: Filter by Target, Walmart, Safeway, and more

### 🚀 Performance & Reliability
- **Fast Response Times**: Optimized for quick product searches
- **Robust Error Handling**: Graceful fallbacks and detailed error messages
- **Caching**: Intelligent caching for improved performance
- **Async Processing**: Non-blocking API calls for better scalability

## 🏗️ Architecture

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   FastAPI App   │───▶│  Perplexity      │───▶│  Serper.dev     │
│                 │    │  Sonar Client    │    │  Google Shopping│
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Product       │    │   Store          │    │   Real URLs &   │
│   Matching      │    │   Discovery      │    │   Images        │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

## 🚀 Quick Start

### 1. Clone and Setup
```bash
git clone <your-repo>
cd grocery-scraper-api
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 2. Configure API Keys
Create a `.env` file in the project root:
```bash
# Required: Perplexity Sonar API Key
PERPLEXITY_API_KEY=your_perplexity_api_key_here

# Required: Serper.dev API Key (for real product URLs and images)
SERPER_API_KEY=your_serper_api_key_here
```

### 3. Run the API
```bash
uvicorn main:app --host 0.0.0.0 --port 8000
```

### 4. Test the API
```bash
# Find stores in a location
curl "http://localhost:8000/sonar/stores/search?location=Chicago,IL"

# Search for products with real URLs and images
curl "http://localhost:8000/sonar/products/search?query=milk&store_name=Target&location=Chicago,IL"
```

## 📚 API Endpoints

### Store Discovery
```http
GET /sonar/stores/search?location={location}
```

**Example Response:**
```json
{
  "location": "Chicago, IL",
  "stores_found": 3,
  "stores": [
    {
      "store_id": "target",
      "store_name": "Target",
      "address": "123 Main St, Chicago, IL 60601",
      "services": ["delivery", "pickup", "in-store"],
      "status": "active",
      "website": "https://www.target.com"
    }
  ],
  "source": "perplexity_sonar"
}
```

### Product Search
```http
GET /sonar/products/search?query={product}&store_name={store}&location={location}
```

**Example Response:**
```json
{
  "query": "oat milk",
  "store_name": "Target",
  "location": "Chicago, IL",
  "products_found": 6,
  "search_timestamp": "2025-08-19T15:42:58.731850",
  "products": [
    {
      "name": "Oatly Original Oatmilk",
      "price": 4.99,
      "availability": "in stock",
      "category": "Dairy Alternatives",
      "brand": "Oatly",
      "size": "64 oz",
      "description": "Original oat milk, creamy and delicious",
      "image_url": "https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcQ77QBCxGp6Fl572X73iaEEaL5qnAB5nse4cjxqaNTr0Hqi8FVhC5xGni3IMPlWoh58k-yhTqQPooAnLWDuwh0R9ucDakiD0Q",
      "product_url": "https://google.com/shopping/product/2512895342606972574?gl=us",
      "rating": 4.5,
      "reviews_count": 1250
    }
  ],
  "source": "perplexity_sonar + serper_dev"
}
```

## 🔧 Configuration

### Environment Variables

| Variable | Description | Required | Example |
|----------|-------------|----------|---------|
| `PERPLEXITY_API_KEY` | Perplexity Sonar API key | ✅ | `pplx-abc123...` |
| `SERPER_API_KEY` | Serper.dev API key | ✅ | `80ff8a83e123e4ae68792aef4a946ee7335bd8ca` |

### API Response Fields

#### Product Fields
- `name`: Product name
- `price`: Current price (float)
- `availability`: Stock status
- `category`: Product category
- `brand`: Brand name
- `size`: Product size/volume
- `description`: Product description
- `image_url`: **Real product image URL** (from Google Shopping)
- `product_url`: **Real product page URL** (from Google Shopping)
- `rating`: Customer rating (1-5)
- `reviews_count`: Number of reviews

## 🛠️ Development

### Project Structure
```
grocery-scraper-api/
├── main.py                 # FastAPI application
├── scraper/
│   ├── sonar_client.py     # Perplexity Sonar integration
│   ├── serper_client.py    # Serper.dev integration
│   ├── models.py           # Pydantic models
│   └── config.py           # Configuration
├── requirements.txt        # Python dependencies
└── .env                    # Environment variables
```

### Key Components

#### SonarClient (`scraper/sonar_client.py`)
- Handles Perplexity Sonar API communication
- Parses AI-generated product information
- Manages store discovery and product search

#### SerperClient (`scraper/serper_client.py`)
- Integrates with Serper.dev for Google Shopping data
- Provides real product URLs and images
- Matches products by name similarity

### Testing
```bash
# Test the API endpoints
python test_sonar.py

# Test Serper.dev integration
python test_serper_integration.py
```

## 🔍 How It Works

### 1. Product Search Flow
1. **User Request**: Search for "oat milk" at Target
2. **Perplexity Sonar**: AI finds products with names, prices, descriptions
3. **Serper.dev**: Gets real URLs and images from Google Shopping
4. **Smart Matching**: Matches products by name similarity
5. **Response**: Returns combined data with real URLs and images

### 2. Store Discovery Flow
1. **User Request**: Find stores in "Chicago, IL"
2. **Perplexity Sonar**: AI discovers grocery stores in the area
3. **Response**: Returns store details with addresses and services

## 🎯 Use Cases

- **E-commerce Integration**: Add real product data to your shopping apps
- **Price Comparison**: Compare prices across multiple stores
- **Inventory Management**: Check product availability and pricing
- **Market Research**: Analyze product offerings and pricing trends
- **Mobile Apps**: Power grocery shopping and price comparison apps

## 🚀 Performance

- **Response Time**: < 5 seconds for product searches
- **Concurrent Requests**: Supports multiple simultaneous searches
- **Caching**: Intelligent caching reduces API calls
- **Error Handling**: Graceful fallbacks for failed requests

## 🔒 Security

- **API Keys**: Stored securely in environment variables
- **No Hardcoded Secrets**: All sensitive data in `.env` file
- **Input Validation**: Pydantic models validate all inputs
- **Error Sanitization**: Safe error messages without sensitive data

## 📈 Future Enhancements

- [ ] **Price History**: Track price changes over time
- [ ] **Nutritional Data**: Add nutritional information for products
- [ ] **Inventory Alerts**: Notify when products come back in stock
- [ ] **Multi-language Support**: Support for international stores
- [ ] **Advanced Filtering**: Filter by price range, brand, etc.
- [ ] **Webhook Support**: Real-time product updates

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## 📄 License

This project is licensed under the MIT License - see the LICENSE file for details.

## 🆘 Support

- **Documentation**: Check this README and inline code comments
- **Issues**: Create an issue on GitHub for bugs or feature requests
- **API Keys**: Get help with Perplexity Sonar and Serper.dev setup

---

**Built with ❤️ using FastAPI, Perplexity Sonar, and Serper.dev**

